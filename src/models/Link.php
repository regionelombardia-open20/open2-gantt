<?php

namespace lispa\amos\gantt\models;

use yii\base\Event;
use yii\base\Model;
use yii\helpers\ArrayHelper;
use yii\helpers\Json;

/**
 * Class Link
 * @package lispa\amos\gantt\models
 *
 * @var integer $id
 * @var integer $task_source_id
 * @var integer $task_target_id
 * @var integer $project_source_id
 * @var integer $project_target_id
 * @var string $type
 *
 */
class Link extends Model
{
    public $id;
    public $task_source_id;
    public $task_target_id;
    public $project_source_id;
    public $project_target_id;
    public $type;
    public $color = "#FFA011";
    public $textColor = "#FFFFFF";

    public $asGanttValue = '{}';

    public function init()
    {
        parent::init(); // TODO: Change the autogenerated stub

        $this->on(self::EVENT_AFTER_VALIDATE, function (Event $event) {

            $source_id = ($event->sender->task_source_id ? Task::$PREFIX_ID . $event->sender->task_source_id : Project::$PREFIX_ID . $event->sender->project_source_id);
            $target_id = ($event->sender->task_target_id ? Task::$PREFIX_ID . $event->sender->task_target_id : Project::$PREFIX_ID . $event->sender->project_target_id);

            $event->sender->asGanttValue =
                Json::encode(
                    ArrayHelper::merge(
                        $event->sender->toArray(),
                        [
                            'id' => $source_id . "_" . $target_id,
                            'source' => $source_id,
                            'target' => $target_id,
                        ]));
        });

    }

    public function toJson($option = 302)
    {
        return Json::encode($this, $option);
    }

}